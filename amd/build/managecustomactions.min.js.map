{"version":3,"file":"managecustomactions.min.js","sources":["../src/managecustomactions.js"],"sourcesContent":["/**\n * Module to handle js on webhooks page in local trigger.\n *\n * @package local_trigger\n * @author Justin Hunt - justin@poodll.com\n */\ndefine(['jquery', 'core/ajax', 'core/str', 'core/log'], function($, ajax, str,log) {\n    const SELECTOR = {\n        CA_SELECTBOX: '.local_trigger_ca_selectbox select',\n        CA_DESCRIPTION: '#fitem_id_description input',\n        CA_PROTOCOL: '#fitem_id_protocol  input',\n    }\n\n    const EVENT = {\n        CHANGE: 'change',\n    }\n\n    const fieldcount=10;\n\n    var stringStore = {};\n\n    const get_fieldname = function(index){\n        return $('#fitem_id_customtext' + index + ' input');\n    };\n\n    const get_fieldhelp = function(index){\n        return $('#fitem_id_customhelp' + index + ' input');\n    };\n\n\n    const initStrings = function (callback) {\n        str.get_strings([\n            {key: \"webhooks_explanation\", component: \"local_trigger\"},\n            {key: \"customactions_explanation\", component: \"local_trigger\"},\n        ]).done(function (strings) {\n            log.debug(strings);\n            stringStore = strings;\n            if (typeof callback == 'function') {\n                callback();\n            }\n        });\n    };\n\n    const clearFields = function(that) {\n\n        $(SELECTOR.CA_DESCRIPTION).val('');\n        $(SELECTOR.CA_PROTOCOL).val('');\n        for(var i=1;i<=fieldcount;i++) {\n            get_fieldname(i).val('');\n            get_fieldhelp(i).val('');\n        }\n    };\n\n\n    const initListeners = function() {\n        var that = this;\n\n        $(SELECTOR.CA_SELECTBOX).on(EVENT.CHANGE, function (e) {\n            log.debug(\"changed\");\n            log.debug($(this).val());\n\n            //clear fields\n            clearFields(that);\n\n            ajax.call([{\n                methodname: 'local_trigger_fetch_function_details',\n                args: {\n                    functionname: $(this).val()\n                }\n            }])[0].done(function (data) {\n                var fdata = JSON.parse(data);\n                $(SELECTOR.CA_DESCRIPTION).val(fdata.description);\n                var index=0;\n                //do required fields first\n                for(var thefieldname in fdata.parameters_desc.keys) {\n                    var thefield = fdata.parameters_desc.keys[thefieldname];\n                    if(thefield.required) {\n                        index++;\n                        get_fieldname(index).val(thefieldname);\n                        var thelabel ='(' + thefield.type + ') ' + thefield.desc + ' (required)';\n                        get_fieldhelp(index).val(thelabel);\n                    }\n                }\n                //do optional fields next\n                for(var thefieldname in fdata.parameters_desc.keys) {\n                    var thefield = fdata.parameters_desc.keys[thefieldname];\n                    if(!thefield.required) {\n                        index++;\n                        get_fieldname(index).val(thefieldname);\n                        var thelabel ='(' + thefield.type + ') ' + thefield.desc + ' (optional)';\n                        get_fieldhelp(index).val(thelabel);\n                    }\n                }\n\n                log.debug(data);\n            });\n        });\n    };\n\n    return {\n        init: function () {\n                initStrings();\n                initListeners();\n        }\n    }\n});"],"names":["define","$","ajax","str","log","SELECTOR","EVENT","get_fieldname","index","get_fieldhelp","initListeners","on","e","debug","this","val","that","i","clearFields","call","methodname","args","functionname","done","data","fdata","JSON","parse","description","thefieldname","parameters_desc","keys","thefield","required","thelabel","type","desc","init","callback","get_strings","key","component","strings"],"mappings":"AAMAA,2CAAO,CAAC,SAAU,YAAa,WAAY,aAAa,SAASC,EAAGC,KAAMC,IAAIC,WACpEC,sBACY,qCADZA,wBAEc,8BAFdA,qBAGW,4BAGXC,aACM,eAONC,cAAgB,SAASC,cACpBP,EAAE,uBAAyBO,MAAQ,WAGxCC,cAAgB,SAASD,cACpBP,EAAE,uBAAyBO,MAAQ,WA4BxCE,cAAgB,WAGlBT,EAAEI,uBAAuBM,GAAGL,cAAc,SAAUM,GAChDR,IAAIS,MAAM,WACVT,IAAIS,MAAMZ,EAAEa,MAAMC,OAhBN,SAASC,MAEzBf,EAAEI,yBAAyBU,IAAI,IAC/Bd,EAAEI,sBAAsBU,IAAI,QACxB,IAAIE,EAAE,EAAEA,GA9BC,GA8BaA,IACtBV,cAAcU,GAAGF,IAAI,IACrBN,cAAcQ,GAAGF,IAAI,IAarBG,GAEAhB,KAAKiB,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CACFC,aAAcrB,EAAEa,MAAMC,UAE1B,GAAGQ,MAAK,SAAUC,UACdC,MAAQC,KAAKC,MAAMH,MACvBvB,EAAEI,yBAAyBU,IAAIU,MAAMG,iBACjCpB,MAAM,MAEN,IAAIqB,gBAAgBJ,MAAMK,gBAAgBC,KAAM,KAC5CC,SAAWP,MAAMK,gBAAgBC,KAAKF,eAC9BI,SAAU,CAClBzB,QACAD,cAAcC,OAAOO,IAAIc,kBACrBK,SAAU,IAAMF,SAASG,KAAO,KAAOH,SAASI,KAAO,cAC3D3B,cAAcD,OAAOO,IAAImB,eAI7B,IAAIL,gBAAgBJ,MAAMK,gBAAgBC,KAAM,KAC5CC,cAAAA,SAAWP,MAAMK,gBAAgBC,KAAKF,eAC7BI,SAAU,CACnBzB,QACAD,cAAcC,OAAOO,IAAIc,cACrBK,SAAU,IAAMF,SAASG,KAAO,KAAOH,SAASI,KAAO,cAC3D3B,cAAcD,OAAOO,IAAImB,WAIjC9B,IAAIS,MAAMW,mBAKf,CACHa,KAAM,WAtEU,IAAUC,SAC1BnC,IAAIoC,YAAY,CACZ,CAACC,IAAK,uBAAwBC,UAAW,iBACzC,CAACD,IAAK,4BAA6BC,UAAW,mBAC/ClB,MAAK,SAAUmB,SACdtC,IAAIS,MAAM6B,SACIA,QACS,mBAAZJ,UACPA,cAgEA5B"}